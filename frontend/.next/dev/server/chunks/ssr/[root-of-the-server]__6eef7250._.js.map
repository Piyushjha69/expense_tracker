{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///D:/expenseTracker/frontend/src/lib/auth.ts"],"sourcesContent":["const ACCESS_KEY = \"access_token\"\r\nconst REFRESH_KEY = \"refresh_token\"\r\n\r\nexport function setAccessToken(token: string) {\r\n    localStorage.setItem(ACCESS_KEY, token)\r\n}\r\n\r\nexport const getAccessToken = () => {\r\n  if (typeof window === \"undefined\") return null;\r\n  return localStorage.getItem(ACCESS_KEY);\r\n};\r\n\r\nexport function setRefreshToken(token: string) {\r\n    localStorage.setItem(REFRESH_KEY, token)\r\n}\r\n\r\nexport const getRefreshToken = () => {\r\n  if (typeof window === \"undefined\") return null;\r\n  return localStorage.getItem(REFRESH_KEY);\r\n};\r\n\r\n\r\nexport function logout() {\r\n    localStorage.removeItem(ACCESS_KEY)\r\n    localStorage.removeItem(REFRESH_KEY)\r\n\r\n    //Redirect to login page\r\n    if(typeof window !== undefined) {\r\n        window.location.href=\"/login\"\r\n    }\r\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA,MAAM,aAAa;AACnB,MAAM,cAAc;AAEb,SAAS,eAAe,KAAa;IACxC,aAAa,OAAO,CAAC,YAAY;AACrC;AAEO,MAAM,iBAAiB;IAC5B,wCAAmC,OAAO;;;AAE5C;AAEO,SAAS,gBAAgB,KAAa;IACzC,aAAa,OAAO,CAAC,aAAa;AACtC;AAEO,MAAM,kBAAkB;IAC7B,wCAAmC,OAAO;;;AAE5C;AAGO,SAAS;IACZ,aAAa,UAAU,CAAC;IACxB,aAAa,UAAU,CAAC;IAExB,wBAAwB;IACxB,wCAAgC;QAC5B,OAAO,QAAQ,CAAC,IAAI,GAAC;IACzB;AACJ"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///D:/expenseTracker/frontend/src/lib/useAuth.ts"],"sourcesContent":["\"use client\"\n\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { useEffect, useState } from \"react\";\nimport { getAccessToken } from \"./auth\";\n\nconst PUBLIC_ROUTES = [\"/login\", \"/register\"]\n\nexport function useAuth (requireAuth: boolean = true) {\n    const router = useRouter()\n    const pathname = usePathname()\n    const [isLoading, setIsLoading] = useState(true)\n    const [isAuthenticated, setIsAuthenticated] = useState(false)\n\n    useEffect(() => {\n        const token = getAccessToken()\n        const hasToken = !!token\n\n        setIsAuthenticated(hasToken)\n\n        if (requireAuth && !hasToken) {\n            //User needs to be authenticated\n            router.replace(\"/login\")\n        } else if (!requireAuth && hasToken && PUBLIC_ROUTES.includes(pathname)) {\n            router.replace(\"/expense\")\n        } else {\n            setIsLoading(false)\n        }\n    }, [requireAuth, router, pathname])\n\n    return {isLoading, isAuthenticated}\n}"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAMA,MAAM,gBAAgB;IAAC;IAAU;CAAY;AAEtC,SAAS,QAAS,cAAuB,IAAI;IAChD,MAAM,SAAS,IAAA,8PAAS;IACxB,MAAM,WAAW,IAAA,gQAAW;IAC5B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gUAAQ,EAAC;IAC3C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,gUAAQ,EAAC;IAEvD,IAAA,iUAAS,EAAC;QACN,MAAM,QAAQ,IAAA,oIAAc;QAC5B,MAAM,WAAW,CAAC,CAAC;QAEnB,mBAAmB;QAEnB,IAAI,eAAe,CAAC,UAAU;YAC1B,gCAAgC;YAChC,OAAO,OAAO,CAAC;QACnB,OAAO,IAAI,CAAC,eAAe,YAAY,cAAc,QAAQ,CAAC,WAAW;YACrE,OAAO,OAAO,CAAC;QACnB,OAAO;YACH,aAAa;QACjB;IACJ,GAAG;QAAC;QAAa;QAAQ;KAAS;IAElC,OAAO;QAAC;QAAW;IAAe;AACtC"}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///D:/expenseTracker/frontend/src/lib/api.ts"],"sourcesContent":["import { getAccessToken, getRefreshToken, logout, setAccessToken } from \"./auth\"\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL\r\n\r\nif (!API_URL) {\r\n    throw new Error(\"NEXT_PUBLIC_API_URL is missing in .env.local\")\r\n}\r\n\r\nexport async function apiFetch(endpoint: string, options: RequestInit = {}) {\r\n    try {\r\n        const token = getAccessToken()\r\n\r\n        const res = await fetch(`${API_URL}${endpoint}`, {\r\n            ...options,\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n                ...(options.headers || {})\r\n            },\r\n            credentials: \"include\"\r\n        })\r\n\r\n        // refresh if access is expired\r\n        if (res.status == 401) {\r\n            //only attempt refresh if we had a token\r\n            if (!token) {\r\n                //no token means user isn't logged in\r\n                if (typeof window !== \"undefined\") {\r\n                    window.location.href = \"/login\"\r\n                }\r\n            }\r\n            throw new Error(\"Please Login to continue\")\r\n\r\n\r\n            const refreshed = await refreshAccessToken()\r\n            if (!refreshed) {\r\n                logout()\r\n                throw new Error(\"Session expired. Please login again\")\r\n            }\r\n\r\n            const newToken = getAccessToken()\r\n            return fetch(`${API_URL}${endpoint}`, {\r\n                ...options,\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    ...(newToken ? { Authorization: `Bearer ${newToken}` } : {}),\r\n                    ...(options.headers || {})\r\n                },\r\n                credentials: \"include\"\r\n            })\r\n        }\r\n        return res\r\n    } catch (err) {\r\n        throw new Error (\"Failed to fetch (Backend not reachable / CORS issue)\")\r\n    }\r\n}\r\n\r\nasync function refreshAccessToken() {\r\n    try {\r\n        const refreshToken = getRefreshToken()\r\n        if(!refreshToken) return false\r\n\r\n        const res = await fetch(`${API_URL}/auth/refersh`, {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"appplication/json\"\r\n            },\r\n            body: JSON.stringify({refreshToken}),\r\n            credentials: \"include\"\r\n        })\r\n\r\n        if (!res.ok) return false\r\n\r\n        const data = await res.json()\r\n        if (data.success && data.data) {\r\n            setAccessToken(data.data.accessToken)\r\n            return true\r\n        }\r\n        return false\r\n    } catch  {\r\n        return false\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEN;;AAIO,eAAe,SAAS,QAAgB,EAAE,UAAuB,CAAC,CAAC;IACtE,IAAI;QACA,MAAM,QAAQ,IAAA,oIAAc;QAE5B,MAAM,MAAM,MAAM,MAAM,GAAG,UAAU,UAAU,EAAE;YAC7C,GAAG,OAAO;YACV,SAAS;gBACL,gBAAgB;gBAChB,GAAI,QAAQ;oBAAE,eAAe,CAAC,OAAO,EAAE,OAAO;gBAAC,IAAI,CAAC,CAAC;gBACrD,GAAI,QAAQ,OAAO,IAAI,CAAC,CAAC;YAC7B;YACA,aAAa;QACjB;QAEA,+BAA+B;QAC/B,IAAI,IAAI,MAAM,IAAI,KAAK;YACnB,wCAAwC;YACxC,IAAI,CAAC,OAAO;gBACR,qCAAqC;gBACrC;;YAGJ;YACA,MAAM,IAAI,MAAM;YAGhB,MAAM,YAAY,MAAM;YACxB,IAAI,CAAC,WAAW;gBACZ,IAAA,4HAAM;gBACN,MAAM,IAAI,MAAM;YACpB;YAEA,MAAM,WAAW,IAAA,oIAAc;YAC/B,OAAO,MAAM,GAAG,UAAU,UAAU,EAAE;gBAClC,GAAG,OAAO;gBACV,SAAS;oBACL,gBAAgB;oBAChB,GAAI,WAAW;wBAAE,eAAe,CAAC,OAAO,EAAE,UAAU;oBAAC,IAAI,CAAC,CAAC;oBAC3D,GAAI,QAAQ,OAAO,IAAI,CAAC,CAAC;gBAC7B;gBACA,aAAa;YACjB;QACJ;QACA,OAAO;IACX,EAAE,OAAO,KAAK;QACV,MAAM,IAAI,MAAO;IACrB;AACJ;AAEA,eAAe;IACX,IAAI;QACA,MAAM,eAAe,IAAA,qIAAe;QACpC,IAAG,CAAC,cAAc,OAAO;QAEzB,MAAM,MAAM,MAAM,MAAM,GAAG,QAAQ,aAAa,CAAC,EAAE;YAC/C,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAC;YAAY;YAClC,aAAa;QACjB;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;QAEpB,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI,KAAK,OAAO,IAAI,KAAK,IAAI,EAAE;YAC3B,IAAA,oIAAc,EAAC,KAAK,IAAI,CAAC,WAAW;YACpC,OAAO;QACX;QACA,OAAO;IACX,EAAE,OAAO;QACL,OAAO;IACX;AACJ"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///D:/expenseTracker/frontend/app/%28auth%29/login/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useRouter } from \"next/navigation\";\nimport { useAuth } from \"../../../src/lib/useAuth\";\nimport { useState } from \"react\";\nimport { apiFetch } from \"../../../src/lib/api\";\nimport { setAccessToken, setRefreshToken } from \"../../../src/lib/auth\";\nimport { toast } from \"sonner\";\nimport { Link } from \"lucide-react\";\n\nexport default function loginPage() {\n    const router = useRouter();\n    const { isLoading: authLoading } = useAuth(false)\n    const [email, setEmail] = useState(\"\")\n    const [password, setPassword] = useState(\"\")\n    const [loading, setLoading] = useState(false)\n    const [errors, setErrors] = useState<{ email?:string; password?:string}>({})\n\n    function validateForm () {\n        const newErrors : { email?:string; password?:string } = {}\n\n        if (!email.trim()){\n            newErrors.email = \"Email is required\"\n        } else if (!/^[^\\s@]+@[^\\s@]+.[^\\s@]+$/.test(email)) {  // Regex E-mail validation (checks email format)\n            newErrors.email = \"Please enter a valid E-mail\" \n        }\n\n        if (!password) {\n            newErrors.password = \"Password is required\"\n        } else if ( password.length < 6 ) {\n            newErrors.password = \"Password must be at least 6 characters\"\n        }\n\n        setErrors (newErrors)\n        return Object.keys(newErrors).length === 0;\n    }\n\n    async function handleLogin (e: React.FormEvent) {\n        e.preventDefault();\n\n        if (!validateForm()) return \n\n        setLoading(true)\n\n        try {\n            const res = await apiFetch(\"/auth/login\", {\n                method: \"POST\",\n                body: JSON.stringify({ email, password})\n            })\n\n            const data = await res.json()\n            if(!data.success) throw new Error(data.message || \"Login failed\")\n\n            const tokens = data.data.tokens\n            setAccessToken(tokens.accessToken)\n            setRefreshToken(tokens.refershToken)\n\n            toast.success(\"Login successful!\")\n            router.push(\"/expense\")\n        } catch (err: any) {\n            toast.error(err.message || \"Login Failed\")\n        } finally {\n            setLoading(false)\n        }\n    }\n\n    if (authLoading) {\n        return  (\n            <div>\n                <div />\n            </div>\n        )\n    }\n\n    return (\n        <div>\n            <header>\n                <Link href=\"/\">\n                    &larr; Back\n                </Link>\n            </header>\n\n            <div>\n                <div>\n                    <h1>Sign in</h1>\n                    <form onSubmit={handleLogin}>\n                        <div>\n                            <input \n                            placeholder=\"Email\"\n                            type=\"email\"\n                            value={email}\n                            onChange={(e) => {\n                                setEmail(e.target.value)\n                                if(errors.email) setErrors({...errors, email: undefined})\n                            }} \n                            />\n                            {errors.email && (\n                                <p>{errors.email}</p>\n                            )}\n                        </div>\n\n                        <div>\n                            <input \n                                placeholder=\"Password\"\n                                type=\"password\"\n                                value={password}\n                                onChange={(e) => {\n                                    setPassword(e.target.value)\n                                    if (errors.password) setErrors({...errors, password: undefined})\n                                }}\n                            />\n                            {errors.password && (\n                                <p>{errors.password}</p>\n                            )}\n                        </div>\n\n                        <button\n                            disabled={loading}\n\n                        >\n                            {loading ? \"Signing in...\" : \"Sign in\"}\n                        </button>\n                    </form>\n\n                    <p>\n                        Don&apos;t have an account?{\" \"}\n                        <Link href=\"/register\">\n                            Register\n                        </Link>\n                    </p>\n                </div>\n            </div>\n        </div>\n    )\n}\n"],"names":[],"mappings":"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"}}]
}